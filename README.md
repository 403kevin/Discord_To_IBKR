# Discord â†’ IBKR Trading Bot

A Python-based bot that listens to trading signals on Discord and executes orders on Interactive Brokers (IBKR) via TWS or Gateway. It supports real-time market data, advanced trailing stops, bracket orders, and logging for auditability and backtesting.

---

## ğŸ§© Features

- **Signal Parsing**: Scrapes Discord channels (no Discord API) for trading signals using flexible buzzword heuristics (BTO, STC, TRIM, etc.).
- **IBKR Integration**: Places market, bracket, and trailing-stop orders in IBKR via `ib_insync`.
- **Advanced Trailing Stops**:
  - Premium-based trailing stop (adaptive based on high-water mark)
  - Breakeven move locking
  - Hard stop-loss
  - Time-based exit
- **Fallbacks & Stability**:
  - Snapshot and streaming price fetch with fallbacks to midpoint or historical bars off-hours.
  - Native IB trail orders as a fallback.
- **Logging & Reporting**:
  - CSV trade log (`trade_log.csv`) with timestamp, symbol, qty, price, action, reason.
  - Colorized console + file logging via `custom_logger.py`.
- **Modular Design**:
  - `ib_interface.py`: IBKR connection and contract/order helpers.
  - `message_parsers.py`: Heuristic common parser for Discord message formats.
  - `trailing_stop_manager.py`: Centralized stop-management logic.
  - `trade_logger.py`: Simple CSV logger.

---

## ğŸ“¦ Prerequisites

- Python 3.8+
- [ib_insync](https://github.com/erdewit/ib_insync)
- `requests`, `python-dateutil`, `colorama`
- Interactive Brokers TWS or IB Gateway running (paper or live account)
- Discord account authorized in target server

---

## ğŸš€ Installation & Setup

1. **Clone the repository**:
   ```bash
   git clone https://github.com/403kevin/Discord_To_IBKR.git
   cd Discord_To_IBKR

2. Create a virtual environment:

python3 -m venv venv
source venv/bin/activate    # On Windows: venv\Scripts\activate


3. Install dependencies:

pip install -r requirements.txt


4. Configure config.py:

DISCORD_AUTH_TOKEN: Your Discord bot/user auth token.

CHANNEL_INFO['channel_id']: ID of the Discord channel to scrape.

TWS or GATEWAY connection settings.

Trailing stop and bracket order parameters.

Fund allocation, price filters, and other strategy flags.



5. Initialize state file:

echo '{"last_log_id": 0}' > last_log_id.json




---

âš™ï¸ Running the Bot

Main Bot:

python main.py

Test Scripts:

snapshot_test.py: One-shot snapshot price fetch.

market_data_tester.py: Streaming price dump.

historical_last_trade.py: Fetch last 1-min bar when markets are closed.

test.py: Custom tests (user-defined).



Logs will appear in console and runtime.log.


---

ğŸ“ File Structure

â”œâ”€â”€ .gitignore
â”œâ”€â”€ config.py
â”œâ”€â”€ custom_logger.py
â”œâ”€â”€ discord_interface.py
â”œâ”€â”€ historical_last_trade.py
â”œâ”€â”€ ib_interface.py
â”œâ”€â”€ last_log_id.json
â”œâ”€â”€ main.py
â”œâ”€â”€ market_data_tester.py
â”œâ”€â”€ message_parsers.py
â”œâ”€â”€ requirements.txt
â”œâ”€â”€ snapshot_test.py
â”œâ”€â”€ test.py
â”œâ”€â”€ trade_log.csv      # auto-generated by trade_logger.py
â”œâ”€â”€ trade_logger.py
â”œâ”€â”€ trailing_stop_manager.py
â””â”€â”€ utils.py


---

ğŸ”œ Next Steps / TODO

Script B: Official Discord API integration (discord.py) for event-driven parsing.

Backtesting Engine: Replay historical signals + IB intraday data.

Signal Confidence Scoring: ML-driven signal filtering.

Notification System: Telegram/Email/Discord webhooks for trade events.

Dashboard: Web UI for performance metrics and analytics.



---

ğŸ¤ Contributing

1. Fork the project.


2. Create your feature branch: git checkout -b feature/YourFeature.


3. Commit your changes: git commit -m 'Add some feature'.


4. Push to the branch: git push origin feature/YourFeature.


5. Open a Pull Request.



Please follow code style, write tests, and update documentation where needed.


---

ğŸ“œ License

MIT License Â© 2025 Kevin Epp



